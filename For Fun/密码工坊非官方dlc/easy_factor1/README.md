## easy_factor1

+ Difficulty：Easy

<br/>

## Solution

题目任务可以简单描述为：三个256bit的素数p、q、r乘积为n，给出n的值以及以下值，要求分解n得到AES密钥，从而解密flag：
$$
hint = k\phi(n)^3
$$
其中k是未知的256bit的随机数。

这本身应该可以看作是一个已知n、kphi分解n的问题，是有现成脚本的，不过问题在于本题给出的是kphi^3，所以脚本跑的可能不是那么顺利，这就需要理解原理才行。

而这种分解的原理本身很简单，由欧拉定理我们知道：
$$
a^{\phi(n)} = 1 \quad(mod\;n)
$$
那么自然也就有：
$$
a^{k\phi(n)^3} = 1 \quad(mod\;n)
$$
而尝试分解kphi^3，可以得到如下的因子列表：

```
2^11 · 3^6 · 7^3 · 13^6 · 41^3 · 79^3 · 83^3 · 277^3 · 248701^3 · 2421845446...11<714>
```

我们的重点在于这些3次方的素因子幂次，比如对于7，他只有3次幂说明什么呢？说明7仅可能是(p-1)、(q-1)、(r-1)三个数中其中一个的因子。由于p、q、r顺序并没有关系，所以我们不妨假设7是p-1的因子，那么如果我们把他完全除掉，得到下面的数字：
$$
t = \frac{hint}{7^3}
$$
此时就有：
$$
t = r\phi(qr)
$$

$$
t \neq s\phi(n)
$$

那么利用欧拉定理也就是：
$$
a^{t} = 1 \quad(mod\;qr)
$$

$$
a^{t} \neq 1 \quad(mod\;n)
$$

所以就可以任取a，计算a^t-1与n的GCD得到qr，那么同理也就得到了p；如此重复几次就能得到全部因子了。

exp：

```python
from Crypto.Util.number import *
from Crypto.Util.Padding import *
from Crypto.Cipher import AES
from hashlib import sha256

n = 343127312894441264623060100705188723106648253383902349620699412384677995734576572885137280031507308915752070128528949423639735964709160841591038148069185325450544546735392923674211031016035209702254447128968565740534765322198664691
hint = 3802744632475774666777934738986183209966233570124815804333822490240409933768208822899072601181527365734196352249978937639454658680559993507805820991037544059215540360338084909833242583087617315128513337647913472696515770688338805196215328080662137260951972365100322795737835152857750114216709340410268143017180826135339564387228460663261697814425298725805568817218360964967025967384766127098203664964210047103829182895016532403825215903779806760754721373523135367007867453212189953817229696304611549977864533229540971457717668560698088917340909962348110683581294453903261530189579223087858081200349343639420534779115290433982968345085704202494045885911950427043282588446343291558819683037970053828479057449781943479407877748772895179095205885377333120540311815022381056
c = b';#\x1b\xa6R\xe2\x1d\x9dpf\x8e\xda\xe4\x14\x9a\xfb\tr\x99\x8a\xc9r\x03C\xb58Zb\x97\x0b\xc7S\x0fa\x88\xb4\xe4\x16.M\x92\x94\x94\x8b\xa9Ki\x9b\xe4\xe9d5\xa3~\x1a\x9cx\x03\xdc\x1f\x87\x14E\x90'


p = n // (GCD(pow(2,hint//7**3,n)-1,n))
q = n // GCD(pow(2,hint//248701**3,n)-1,n)
r = n // p // q

key = sha256(str(p+q+r).encode()).digest()
enc = AES.new(key, AES.MODE_ECB)
flag = enc.decrypt(c)

print(flag)

#NSSCTF{Just_simply_try_t0_divid3_s0m3_f4ct0rs_0f_phi}
```

