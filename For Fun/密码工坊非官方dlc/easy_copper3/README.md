## easy_copper3

+ Difficulty：Middle

## Solution

对于题目的u有
$$
uq = 1 \quad(mod\;p)
$$
展开成等式得到：
$$
uq = 1 + kp
$$
同乘q：
$$
uq^2 = q + kn
$$
所以在模n下有：
$$
uq^2 - q = 0 \quad(mod\;n)
$$
q仅有n一半的数量级，因此可以当作小根去做copper，但因为一半只是理论上界所以要加爆破才行。又因为q是素数，所以这里就可以用上copper2的优化的爆破方法，不直接爆破二进制位，而是爆破q模$2310 = 2\cdot 3 \cdot 5 \cdot 7 \cdot 11$的余数来加快速度。

exp：

```python
from Crypto.Util.number import *
from multiprocessing import Pool
from tqdm import *

n = 57054300236523364297068573084561858708294662390960413501481702646411973922601148943850295724745015979460852792874663924727251780057665081615966986614006891899776582114850433561286026344516509555159123543852355598205747122411634510298915483597709877911019093953862935760391037639842229970271659629400825516949
e = 3914808559
c = 34367961236912765697312756121175172638962230270006286310938236988443532571967649877497844350082733634910858022991620956125616557464236977620127700161939950208821044710180411053388650174106798369640918760166665311872344484980029847646184112357339382437302111172508120844002507660831969088208714656235021379114
u = 3971337705608798216937148389824777665706019231614517125236102421717365951782208458636759087630906187451681891734064328433966129922001851802738564150946911

def attack(q_low):
    PR.<x> = PolynomialRing(Zmod(n))
    f = u*(2310*x + q_low)^2 - (2310*x + q_low)
    f = f.monic()
    res = f.small_roots(X=2^512//2310,beta=1,epsilon=0.0199)

    if(res != []):
        print(q_low)
        q = 2310*int(res[0]) + q_low
        p = n // q
        print(long_to_bytes(int(pow(c,inverse(e,(p-1)*(q-1)),n))))
        return True

pos = []
for i in range(1,2310):
    if(GCD(i,2310) == 1):
        pos.append(i)

#q_low = 1751
with Pool(16) as pool:
    for i in tqdm(pool.imap(attack, pos), total=len(pos)):
        if(i == True):
            break

#NSSCTF{En0ugh_F0r_c0op3r!}
```

